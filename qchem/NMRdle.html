<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NMRdle</title>
  <style>
    :root{
      --bg: #ffffff; --fg:#111827; --card:#ffffff; --muted:#f3f4f6; --border:#e5e7eb; --muted-fg:#6b7280;
      --success:#6aaa64; --danger:#d7373f;  --shadow: 0 6px 18px rgba(0,0,0,.06);
    }
    .dark{
      --bg:#0b0c10; --fg:#e5e7eb; --card:#13151a; --muted:#1b1e25; --border:#2a2f3a; --muted-fg:#9aa4b2;
      --shadow: 0 6px 18px rgba(0,0,0,.35);
    }
    body{margin:0;font-family:sans-serif;background:var(--bg);color:var(--fg)}
    .container{width:90%;margin:auto;padding:20px;display:grid;grid-template-columns:2fr 3fr;gap:20px}
    .left{border:1px solid var(--border);padding:20px;border-radius:12px;background:var(--card);box-shadow:var(--shadow)}
    .right{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .tile{border:1px solid var(--border);border-radius:8px;overflow:hidden;cursor:pointer;background:var(--muted);display:flex;align-items:center;justify-content:center;transition:transform 0.15s ease;}
    .tile:hover:not(.correct):not(.incorrect){transform:scale(1.05);}
    .tile img{width:100%;height:100%;object-fit:contain;}
    .tile.correct{background:var(--success)!important;transform:none;}
    .tile.incorrect{background:var(--danger)!important;transform:none;}
    .topbar{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;border-bottom:1px solid var(--border)}
    .switch-wrapper{display:flex;align-items:center;gap:8px;}
    .lives-wrapper{margin: auto;display:flex;align-items:center;gap:8px;}
    .switch{position:relative;display:inline-block;width:40px;height:20px;}
    .switch input{opacity:0;width:0;height:0;}
    .slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:var(--muted-fg);transition:.4s;border-radius:34px;}
    .slider:before{position:absolute;content:"";height:14px;width:14px;left:3px;bottom:3px;background-color:white;transition:.4s;border-radius:50%;}
    input:checked + .slider{background-color:var(--success);}
    input:checked + .slider:before{transform:translateX(20px);}
    .nmr-image{max-width:100%;margin-top:5px;border:1px solid var(--border);border-radius:8px;transition:transform 0.15s ease;cursor:pointer;}
    .nmr-image:hover{transform:scale(1.05);}
    .fullscreen-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);display:flex;align-items:center;justify-content:center;z-index:1000;}
    .fullscreen-overlay img{max-width:90%;max-height:90%;}
    .close-btn{position:absolute;top:20px;right:30px;color:white;font-size:30px;cursor:pointer;}
.info-btn {background: none;border: none;cursor: pointer;display: flex;align-items: center;justify-content: center;padding: 4px;transition: transform 0.15s ease;color: var(--fg);}
.info-btn svg {width: 22px;height: 22px;}
.info-btn:hover {transform: scale(1.2);color: var(--success);}

#shareBtn {background: var(--success);border: none;padding: 10px 20px;color: white;border-radius: 8px;cursor: pointer;margin: 15px auto 0 auto; /* centers horizontally */
  font-size: 1em;display: block; /* needed for margin auto centering */text-align: center;}
#shareBtn:hover {background: #579d55;}

/* Modal styles */
.modal {display: none;position: fixed;z-index: 2000;left: 0; top: 0;width: 100%; height: 100%;background: rgba(0,0,0,0.6);display: flex;align-items: center;justify-content: center;}
.modal-content {background: var(--card);color: var(--fg);padding: 20px;border-radius: 10px;max-width: 500px;box-shadow: var(--shadow);position: relative;}
.modal .close {position: absolute;top: 10px; right: 15px;font-size: 24px;cursor: pointer;}


  </style>
</head>
<body>
    <script type="text/javascript" src="https://unpkg.com/smiles-drawer@2.0.1/dist/smiles-drawer.min.js"></script>
  <div class="topbar">
    <div><strong>NMRdle <span id="number">#1</span></strong> ‚Äî üî• <span id="streak">0</span></div>
  <div class = "lives-wrapper">‚ù§Ô∏è <span id="lives">5</span></div>
    <div class="switch-wrapper">
<button class="info-btn" id="infoBtn" aria-label="About">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
      <line x1="12" y1="8" x2="12" y2="8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="12" y1="11" x2="12" y2="16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button>      <span>Light</span>
      <label class="switch">
        <input type="checkbox" id="themeToggle">
        <span class="slider"></span>
      </label>
      <span>Dark</span>
    </div>
  </div>
  <div class="container">
    <div class="left">
      <div id="formula"><h3>Molecular Formula: </h3></div>
      <h4>1H NMR:</h4>
      <img id="hnmrImage" class="nmr-image" src="hnmr.png" alt="1H NMR Spectrum">
      <h4>13C NMR:</h4>
      <img id="cnmrImage" class="nmr-image" src="cnmr.png" alt="13C NMR Spectrum">
      <h4>IR Peaks:</h4>
      <div id="ir"></div>
      <h4>UV/Vis Peaks:</h4>
      <div id="uv">254 nm</div>
    </div>
    <div class="right" id="grid"></div>
  </div>
  <div id="fullscreenOverlay" class="fullscreen-overlay" style="display:none;">
    <span class="close-btn" id="closeFullscreen">&times;</span>
    <img id="fullscreenImage" src="" alt="Fullscreen NMR">
  </div>


<div id="aboutModal" class="modal" style="display:none">
  <div class="modal-content">
    <span class="close" id="closeAbout">&times;</span>
    <h2>About NMRdle</h2>
    <p>NMRdle is a daily molecular structure guessing game. You are given molecular formula, NMR, IR, and UV/Vis data. Pick the correct molecule from the 4x4 grid. You have 5 lives. Good luck!</p>
    <p>NMR spectra provided by SpectraBase & NMRium</p>
    <p>SMILES rendering provided by SmilesDrawer 2.0</p>
    <p>¬© Toby Collins, 2025</p>
  </div>
</div>

<div id="winModal" class="modal" style="display:none">
  <div class="modal-content">
    <span class="close" id="closeWin">&times;</span>
    <h2>You Win! üéâ</h2>
    <p id="winMessage"></p>
    <button id="shareBtn">Share</button>
  </div>
</div>

<div id="loseModal" class="modal" style="display:none">
  <div class="modal-content">
    <span class="close" id="closeLose">&times;</span>
    <h2>Game Over! üíî</h2>
    <p id="loseMessage">Better luck next time.</p>
  </div>
</div>




  <script>
    const puzzles = {
	'default': {
	num: '0',
        formula: 'C<sub>8</sub>H<sub>9</sub>NO<sub>2</sub>',
        ir: ['3316', '3153', '2791', '1647', '1569'],
        uv: ['243 nm'],
        hnmrImage: 'default/HNMR.gif',
        cnmrImage: 'default/CNMR.gif',
        answer: 0,
        smiles: [
          'OC1=CC=C(NC(C)=O)C=C1','COC(=O)C1=CC=CC=C1N','C1=CC(=CC=C1CN)C(=O)O','CC1=C(C=C(C=C1)[N](=O)[O])C','CCOC(=O)C1=CN=CC=C1','CNC1=CC=CC=C1C(=O)O','C1=CC(=CC=C1CC(=O)N)O','C1CCC2=C(C1)C(=O)NC2=O','CNC(=O)OC1=CC=CC=C1','C1OC2=C(O1)C=C(C=C2)CN','CC1=CC(=C(C=C1)C(=O)O)N','CNC(=O)C1=CC=CC=C1O'
        ]
      },
	'2025-08-16': {
	num: '2',
        formula: 'C<sub>7</sub>H<sub>4</sub>ClNO<sub>2</sub>',
        ir: ['3162', '3075', '1791', '1610', '1488'],
        uv: ['273 nm'],
        hnmrImage: '2025-08-16/HNMR.png',
        cnmrImage: '2025-08-16/CNMR.png',
        answer: 0,
        smiles: [
          'C1=CC2=C(C=C1Cl)NC(=O)O2','C1=C(C=C(N=C1C=O)C=O)Cl','C1C2=CC(=NC=C2C(=O)O1)Cl','C1C2=C(C=CC(=N2)Cl)C(=O)O1','C1=CC(=C(C(=C1O)O)C#N)Cl','C1=CC(=CC2=NC(=O)OC21)Cl','C1=CC(=CN=C1)C(=O)C(=O)Cl','C1C2=C(C(=NC=C2)Cl)C(=O)O1','C1CCC2=C(C1)C(=O)NC2=O','C1=C(C=NC(=C1C=O)Cl)C=O','C1=CC(=NC(=C1)Cl)C(=O)C=O','C1=C2C(=CC(=C1Cl)O)OC=N2'
        ]
      },
	'2025-08-17': {
	num: '3',
        formula: 'C<sub>10</sub>H<sub>10</sub>SO',
        ir: ['3006', '2915', '1680', '1597'],
        uv: ['275 nm'],
        hnmrImage: '2025-08-17/HNMR.png',
        cnmrImage: '2025-08-17/CNMR.png',
        answer: 0,
        smiles: [
          'CC1=CC2=C(C=C1)SCCC2=O','C1CC(=O)C2=CC=CC=C2SC1','C1CC(=CC(=O)C1)C2=CSC=C2','CC1CSC2=CC=CC=C2C1=O','CC(=O)/C=C/SC1=CC=CC=C1','CSC1=CC2=C(CCC2=O)C=C1','C[C](C1=CSC2=CC=CC=C21)O','C1CC2=C(C=CC(=C2)C=O)SC1','CC1=CC2=C(C(=C1)OC)SC=C2','CC1=CC2=C(C=C1)SC(=C2)CO','CCC1C2=CC=CC=C2C(=O)S1','CC1=C(SC2=C1C=CC(=C2)O)C'
        ]
      },
	'2025-08-18': {
	num: '4',
        formula: 'C<sub>8</sub>H<sub>8</sub>O<sub>3</sub>',
        ir: ['3339', '2911', '2839', '1679', '1589'],
        uv: ['348 nm'],
        hnmrImage: '2025-08-18/HNMR.png',
        cnmrImage: '2025-08-18/CNMR.png',
        answer: 0,
        smiles: [
          'COC1=C(C=CC(=C1)C=O)O','COC(=O)C1=CC=C(C=C1)O','COC(=O)C1=CC=CC=C1O','C1=CC=C(C(=C1)CC(=O)O)O','C1=CC=C(C=C1)C(C(=O)O)O','CC1=C(C(=CC=C1)C(=O)O)O','CC(=O)C1=C(C=C(C=C1)O)O','COC1=CC=C(C=C1)C(=O)O','C1OC2=C(O1)C=C(C=C2)CO','COC1=CC=CC(=C1O)C=O','C1=CC(=C(C=C1CC=O)O)O','C1CCC2=C(C1)C(=O)OC2=O'
        ]
      }


    };

const today = new Date();
const dateStr = today.toISOString().split('T')[0]; // YYYY-MM-DD
	won = false;
	if (getCookie(dateStr + "-won") === "true") won = true; 
	current = puzzles["default"];
	if (dateStr in puzzles) current = puzzles[dateStr]; // first puzzle in file
	else current = puzzles["default"];
	
	const yesterday = new Date(today - 86400000);
	const yesterdayStr = yesterday.toISOString().split('T')[0]; // YYYY-MM-DD
	streak = 0;
	if ((getCookie("lastPlayed") === yesterdayStr || getCookie("lastPlayed") === dateStr) && getCookie("streak") !== "") {
		streak = Number(getCookie("streak"));
	}

    lives_stored = getCookie(dateStr + "-lives");
    if (lives_stored === "") lives_stored = "5";
    let lives = Number(lives_stored);
    const grid = document.getElementById('grid');
    const livesEl = document.getElementById('lives');
    const streakEl = document.getElementById('streak');
    livesEl.textContent = lives;
    streakEl.textContent = streak;

	let correct_smiles = current.smiles[current.answer];
//	shuffle(current.smiles);
	current.answer = current.smiles.indexOf(correct_smiles);

    function renderSMILES(){
        let moleculeOptions = {};
        let reactionOptions = {};
      if (document.getElementById("themeToggle").checked) setCookie("theme", "dark", 365);
      else setCookie("theme", "light", 365);

      current.smiles.forEach((src,i)=>{

        let sd = new SmiDrawer(moleculeOptions, reactionOptions);
	let ID = "img-" + i.toString()	;
	if ( document.getElementById("themeToggle").checked === false ) {
		sd.draw(src, "#" + ID, "light");	
	} else {
		sd.draw(src, "#" + ID, "dark");
	}
	});

}

    function renderPuzzle(){
      document.getElementById('formula').innerHTML = "<h3>Molecular Formula: " + current.formula + "</h3>";
      document.getElementById('ir').innerHTML = current.ir.map(p=>`${p} cm‚Åª¬π`).join(', ');
      document.getElementById('uv').innerHTML = current.uv.map(p=>`${p}`).join(', ');
      document.getElementById('hnmrImage').src = current.hnmrImage;
      document.getElementById('cnmrImage').src = current.cnmrImage;
      document.getElementById('number').innerHTML = "#" + current.num;

      document.getElementById('hnmrImage').onclick = () => openFullscreen(current.hnmrImage);
      document.getElementById('cnmrImage').onclick = () => openFullscreen(current.cnmrImage);

      grid.innerHTML = '';
      current.smiles.forEach((src,i)=>{
        const tile = document.createElement('div');
        tile.className = 'tile';
	if (i === current.answer) {
		tile.id = "correct_tile";
	}
        const img = document.createElement('img');
	img.id = "img-" + i.toString();

        tile.appendChild(img);
        tile.addEventListener('click', ()=>{
          if(tile.classList.contains('correct') || tile.classList.contains('incorrect') || lives <= 0 || won) return;
          if(i === current.answer){
            tile.classList.add('correct');
	    won = true;
	    setCookie(dateStr + "-" + src.replace(/=/g, "~"), "correct", 1);
	    setCookie(dateStr + "-won", "true", 1);
	    streak++;
	    setCookie("streak", streak, 365);
	    setCookie("lastPlayed", dateStr, 365);
	    streakEl.textContent = streak;
	    showWinModal();
          } else {
            tile.classList.add('incorrect');
            lives--;
            livesEl.textContent = lives;
	
	    setCookie(dateStr + "-lives", lives.toString(), 1);
	    setCookie(dateStr + "-" + src.replace(/=/g, "~"), "incorrect", 1);
            if(lives <= 0){
		document.getElementById("correct_tile").classList.add('correct');
       	        setCookie(dateStr + "-" + correct_smiles.replace(/=/g, "~"), "correct", 1);
		    showLoseModal();
            }
          }
        });

	if (getCookie(dateStr + "-" + src.replace(/=/g, "~")) === "incorrect") {
            tile.classList.add('incorrect');
	} else if (getCookie(dateStr + "-" + src.replace(/=/g, "~")) === "correct") {
            tile.classList.add('correct');
	}	

        grid.appendChild(tile);        

      });
    }

document.getElementById('closeWin').addEventListener('click', () => {
  document.getElementById('winModal').style.display = 'none';
});

document.getElementById('closeLose').addEventListener('click', () => {
  document.getElementById('loseModal').style.display = 'none';
});


document.getElementById('shareBtn').addEventListener('click', () => {
  const shareText = `I solved today‚Äôs NMRdle with ${lives} ‚ù§Ô∏è remaining. Try to beat me! https://tmncollins.github.io/Tired-Programmer/qchem/NMRdle`;
  navigator.clipboard.writeText(shareText).then(() => {
    alert('Result copied to clipboard!');
  });
});

function shuffle(array) {
  let currentIndex = array.length;

  // While there remain elements to shuffle...
  while (currentIndex != 0) {

    // Pick a remaining element...
    let randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex--;

    // And swap it with the current element.
    [array[currentIndex], array[randomIndex]] = [
      array[randomIndex], array[currentIndex]];
  }
}

function showWinModal(){
  let NUM = document.getElementById('number').innerHTML;
  document.getElementById('winMessage').textContent = 
    'You solved NMRdle ' + NUM + ` with ${lives} lives remaining!`;
  document.getElementById('winModal').style.display = 'flex';
}

function showLoseModal(){
  document.getElementById('loseModal').style.display = 'flex';
}


function setCookie(cname, cvalue, exdays) {
  const d = new Date();
  d.setTime(d.getTime() + (exdays*24*60*60*1000));
  let expires = "expires="+ d.toUTCString();
  document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
}

function getCookie(cname) {
  let name = cname + "=";
  let decodedCookie = decodeURIComponent(document.cookie);
  let ca = decodedCookie.split(';');
  for(let i = 0; i <ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}



    renderPuzzle();

    renderSMILES();

    document.getElementById('themeToggle').addEventListener('change', (e)=>{
      document.body.classList.toggle('dark', e.target.checked);
      renderSMILES();
    });

    function openFullscreen(src){
      const overlay = document.getElementById('fullscreenOverlay');
      const fullImg = document.getElementById('fullscreenImage');
      fullImg.src = src;
      overlay.style.display = 'flex';
    }
    document.getElementById('closeFullscreen').onclick = () => {
      document.getElementById('fullscreenOverlay').style.display = 'none';
    }
// About modal logic
const aboutModal = document.getElementById('aboutModal');
const infoBtn = document.getElementById('infoBtn');
const closeAbout = document.getElementById('closeAbout');

infoBtn.onclick = () => { aboutModal.style.display = 'flex'; };
closeAbout.onclick = () => { aboutModal.style.display = 'none'; };
window.onclick = (e) => { if (e.target === aboutModal) aboutModal.style.display = 'none'; };

    if (getCookie("theme") === "dark") {
	alert("dark");
//	document.getElementById("themeToggle").checked = true;
        document.body.classList.toggle('dark', e.target.checked);
    }


  </script>
</body>


</html>

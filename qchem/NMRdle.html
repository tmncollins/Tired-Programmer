<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NMRdle</title>
	<link rel="icon" type="image/png" href="favicon.png" />
  <style>
    :root{
      --bg: #ffffff; --fg:#111827; --card:#ffffff; --muted:#f3f4f6; --border:#e5e7eb; --muted-fg:#6b7280;
      --success:#6aaa64; --danger:#d7373f;  --shadow: 0 6px 18px rgba(0,0,0,.06);
    }
    .dark{
      --bg:#0b0c10; --fg:#e5e7eb; --card:#13151a; --muted:#1b1e25; --border:#2a2f3a; --muted-fg:#9aa4b2;
      --shadow: 0 6px 18px rgba(0,0,0,.35);
    }
    body{margin:0;font-family:sans-serif;background:var(--bg);color:var(--fg)}
    .container{width:90%;margin:auto;padding:20px;display:grid;grid-template-columns:2fr 3fr;gap:20px}
    .left{border:1px solid var(--border);padding:20px;border-radius:12px;background:var(--card);box-shadow:var(--shadow)}
    .right{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .tile{border:1px solid var(--border);border-radius:8px;overflow:hidden;cursor:pointer;background:var(--muted);display:flex;align-items:center;justify-content:center;transition:transform 0.15s ease;}
    .tile:hover:not(.correct):not(.incorrect){transform:scale(1.05);}
    .tile img{width:100%;height:100%;object-fit:contain;}
    .tile.correct{background:var(--success)!important;transform:none;}
    .tile.incorrect{background:var(--danger)!important;transform:none;}
    .topbar{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;border-bottom:1px solid var(--border)}
    .switch-wrapper{display:flex;align-items:center;gap:8px;}
    .lives-wrapper{margin: auto;display:flex;align-items:center;gap:8px;}
    .switch{position:relative;display:inline-block;width:40px;height:20px;}
    .switch input{opacity:0;width:0;height:0;}
    .slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:var(--muted-fg);transition:.4s;border-radius:34px;}
    .slider:before{position:absolute;content:"";height:14px;width:14px;left:3px;bottom:3px;background-color:white;transition:.4s;border-radius:50%;}
    input:checked + .slider{background-color:var(--success);}
    input:checked + .slider:before{transform:translateX(20px);}
    .nmr-image{max-width:100%;margin-top:5px;border:1px solid var(--border);border-radius:8px;transition:transform 0.15s ease;cursor:pointer;}
    .nmr-image:hover{transform:scale(1.05);}
    .fullscreen-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);display:flex;align-items:center;justify-content:center;z-index:1000;}
    .fullscreen-overlay img{max-width:90%;max-height:90%;margin: 15px auto 0 auto;display: block;}
    .close-btn{position:absolute;top:20px;right:30px;color:white;font-size:30px;cursor:pointer;}
.info-btn {background: none;border: none;cursor: pointer;display: flex;align-items: center;justify-content: center;padding: 4px;transition: transform 0.15s ease;color: var(--fg);}
.info-btn svg {width: 22px;height: 22px;}
.info-btn:hover {transform: scale(1.2);color: var(--success);}
.icon {height: 25px;}
.icon-dark {height: 25px; filter:invert();}

.bar-container { display: flex; width: 100%; height: 25px;margin-top: 10px; border: 1px solid var(--border); border-radius: 6px; overflow: hidden;}
.bar-segment {flex: 1; display: flex; align-items: center; justify-content: center; font-size: 0.8em; font-weight: bold; color: white;}

.lives-0 { background: #d7373f; }  /* red */
.lives-1 { background: #e25d2f; }  /* reddish-orange */
.lives-2 { background: #e6a93b; }  /* orange-yellow */
.lives-3 { background: #c6c93f; }  /* yellow-green */
.lives-4 { background: #8bc34a; }  /* mid green */
.lives-5 { background: #4caf50; }  /* full green */


#shareBtn {background: var(--success);border: none;padding: 10px 20px;color: white;border-radius: 8px;cursor: pointer;margin: 15px auto 0 auto; /* centers horizontally */
  font-size: 1em;display: block; /* needed for margin auto centering */text-align: center;}
#shareBtn:hover {background: #579d55;transform:scale(1.05);}
#donateAction {background: var(--success);border: none;padding: 10px 20px;color: white;border-radius: 8px;cursor: pointer;margin: 15px auto 0 auto; /* centers horizontally */
  font-size: 1em;display: block; /* needed for margin auto centering */text-align: center;}
#donateAction:hover {background: #579d55;transform:scale(1.05);}

/* Modal styles */
.modal {display: none;position: fixed;z-index: 2000;left: 0; top: 0;width: 100%; height: 100%;background: rgba(0,0,0,0.6);display: flex;align-items: center;justify-content: center;}
.modal-content {background: var(--card);color: var(--fg);padding: 20px;border-radius: 10px;max-width: 500px;box-shadow: var(--shadow);position: relative;}
.modal .close {position: absolute;top: 10px; right: 15px;font-size: 24px;cursor: pointer;}
.modal-overlay {background: var(--card);color: var(--fg);padding: 20px;border-radius: 10px;max-width: 90%;box-shadow: var(--shadow);position: relative;align-items:center;justify-content:center;}
.modal-button {background: var(--success);border: none;padding: 10px 20px;color: white;border-radius: 8px;cursor: pointer;margin: 15px auto 0 auto; /* centers horizontally */
  font-size: 1em;display: block; /* needed for margin auto centering */text-align: center;}
.modal-button:hover {background: #579d55;transform:scale(1.05);}


/* Date input styled */
#puzzleDate {padding: 8px 12px;font-size: 1rem;border: 1px solid var(--border);border-radius: 6px;background: var(--muted);color: var(--fg);margin: 15px auto 0 auto;display: block;}

  </style>
</head>
<body>
    <script type="text/javascript" src="https://unpkg.com/smiles-drawer@2.0.1/dist/smiles-drawer.min.js"></script>
  <div class="topbar">
    <img id="icon" src="favicon.png" class="icon">
	<div><strong>NMRdle <span id="number">#1</span></strong> ‚Äî üî• <span id="streak">0</span></div>
  <div class = "lives-wrapper">‚ù§Ô∏è <span id="lives">5</span></div>
    <div class="switch-wrapper">
<button class="info-btn" id="infoBtn" aria-label="About">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
      <line x1="12" y1="8" x2="12" y2="8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="12" y1="11" x2="12" y2="16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button> 
<button id="statsBtn" class="info-btn" aria-label="Statistics">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" fill="currentColor">
    <rect x="3" y="10" width="4" height="11" rx="1"></rect>
    <rect x="10" y="2" width="4" height="19" rx="1"></rect>
    <rect x="17" y="6" width="4" height="15" rx="1"></rect>
  </svg>
</button>    

<button id="calendarBtn" class="info-btn" title="Select Date" aria-label="Select Date">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
       width="22" height="22" fill="none" stroke="currentColor"
       stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <title>Calendar</title>
    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
    <line x1="16" y1="2" x2="16" y2="6"></line>
    <line x1="8" y1="2" x2="8" y2="6"></line>
    <line x1="3" y1="10" x2="21" y2="10"></line>
  </svg>
</button>
 
   <!-- üí≤ Donate button -->
    <button id="donateBtn" class="info-btn" title="Donate">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"
           viewBox="0 0 24 24" width="24" height="24">
        <path stroke-width="2" d="M12 1v22M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H7"/>
      </svg>
    </button>

<span>Light</span>
      <label class="switch">
        <input type="checkbox" id="themeToggle">
        <span class="slider"></span>
      </label>
      <span>Dark</span>
    </div>
  </div>
  <div class="container">
    <div class="left">
      <div id="formula"><h3>Molecular Formula: </h3></div>
      <h4><sup>1</sup>H NMR (<span id='hnmrFreq'>80 MHz</span>):</h4>
      <img id="hnmrImage" class="nmr-image" src="hnmr.png" alt="1H NMR Spectrum">
      <h4><sup>13</sup>C NMR (200 MHz):</h4>
      <img id="cnmrImage" class="nmr-image" src="cnmr.png" alt="13C NMR Spectrum">
      <h4>IR Peaks:</h4>
      <div id="ir"></div>
      <h4>UV/Vis Peaks:</h4>
      <div id="uv">254 nm</div>
    </div>
    <div class="right" id="grid"></div>
  </div>

  <div id="fullscreenOverlay" class="fullscreen-overlay" style="display:none;">
<div class="modal">
    <span class="close-btn" id="closeFullscreen">&times;</span>
  <div class="modal-overlay">
    <img id="fullscreenImage" src="" alt="Fullscreen NMR", style:"bg:#ffffff">
  </div>
  </div>
  </div>


<div id="aboutModal" class="modal" style="display:none">
  <div class="modal-content">
    <span class="close" id="closeAbout">&times;</span>
    <h2>About NMRdle</h2>
    <p>NMRdle is a daily molecular structure guessing game. You are given molecular formula, NMR, IR, and UV/Vis data. Pick the correct molecule from the 12 options. You have 5 lives. Good luck!</p>
    <p>NMR spectra provided by ChemDraw</p>
    <p>SMILES rendering provided by SmilesDrawer 2.0</p>
    <p>¬© Toby Collins, 2025</p>
  </div>
</div>

<div id="winModal" class="modal" style="display:none">
  <div class="modal-content">
    <span class="close" id="closeWin">&times;</span>
    <h2>You Win! üéâ</h2>
    <p id="winMessage"></p>
    <button id="shareBtn">Share</button>
  </div>
</div>

<div id="winArchiveModal" class="modal" style="display:none">
  <div class="modal-content">
    <span class="close" id="closeArchiveWin">&times;</span>
    <h2>You Win! üéâ</h2>
    <p id="winArchiveMessage"></p>
  </div>
</div>

<div id="loseModal" class="modal" style="display:none">
  <div class="modal-content">
    <span class="close" id="closeLose">&times;</span>
    <h2>Game Over! üíî</h2>
    <p id="loseMessage">Better luck next time.</p>
  </div>
</div>

<div id="statsModal" class="modal" style="display:none">
  <div class="modal-content">
    <span class="close" id="closeStats">&times;</span>
    <h2>My Stats</h2>
    <p>Games Played: <span id="gamesPlayed">0</span></p>
    <p>Current Streak: <span id="currentStreak">0</span></p>
    <p>Longest Streak: <span id="longestStreak">0</span></p>
<div id="livesDistribution">
  <h3>Score Distribution</h3>
  <div class="bar-container" id="livesBar"></div>
</div>
  </div>
</div>

<div id="donateModal" class="modal" style="display:none;">
  <div class="modal-content">
    <span class="close" id="closeDonate">&times;</span>
    <h2>Support NMRdle</h2>
    <p>NMRdle is free to play.</p>
    <p>Building and running NMRdle takes up a lot of time and money. If you enjoy playing this game, please consider supporting its development.</p>
    <p>Your contributions support:</p>
    <ul><li>Web hosting and bandwith</li><li>Creating and testing the NMR puzzles</li><li>More future projects</li></ul>
    <button id="donateAction">Donate ‚ù§Ô∏è</button>
  </div>
</div>

<div id="calendarModal" class="modal" style="display:none;">
  <div class="modal-content">
    <span class="close" id="closeCalendar">&times;</span>
    <h2>NMRdle Archive</h2>
    <p>Choose any past date to replay the challenge:</p>
    <input type="date" id="puzzleDate">
    <br>
    <button class="modal-button" id="loadDateBtn">Load Puzzle</button>
  </div>
</div>


  <script>
    const puzzles = {
	'default': {
	num: '0', formula: 'C<sub>8</sub>H<sub>9</sub>NO<sub>2</sub>',
        ir: ['3316', '3153', '2791', '1647', '1569'], uv: ['243 nm'],
	hnmrFreq: "80 MHz", hnmrImage: 'default/HNMR.png', cnmrImage: 'default/CNMR.png',
        answer: 0, smiles: [
          'OC1=CC=C(NC(C)=O)C=C1','COC(=O)C1=CC=CC=C1N','C1=CC(=CC=C1CN)C(=O)O','CC1=C(C=C(C=C1)[N](=O)[O])C','CCOC(=O)C1=CN=CC=C1','CNC1=CC=CC=C1C(=O)O','C1=CC(=CC=C1CC(=O)N)O','C1CCC2=C(C1)C(=O)NC2=O','CNC(=O)OC1=CC=CC=C1','C1OC2=C(O1)C=C(C=C2)CN','CC1=CC(=C(C=C1)C(=O)O)N','CNC(=O)C1=CC=CC=C1O'
        ]
      },
	'2025-08-16': {
	num: '2', formula: 'C<sub>7</sub>H<sub>4</sub>ClNO<sub>2</sub>',
        ir: ['3162', '3075', '1791', '1610', '1488'], uv: ['273 nm'],
	hnmrFreq: "80 MHz", hnmrImage: '2025/08/16/HNMR.png', cnmrImage: '2025/08/16/CNMR.png',
        answer: 0, smiles: [
          'C1=CC2=C(C=C1Cl)NC(=O)O2','C1=C(C=C(N=C1C=O)C=O)Cl','C1C2=CC(=NC=C2C(=O)O1)Cl','C1C2=C(C=CC(=N2)Cl)C(=O)O1','C1=CC(=C(C(=C1O)O)C#N)Cl','C1=CC(=CC2=NC(=O)OC21)Cl','C1=CC(=CN=C1)C(=O)C(=O)Cl','C1C2=C(C(=NC=C2)Cl)C(=O)O1','C1CCC2=C(C1)C(=O)NC2=O','C1=C(C=NC(=C1C=O)Cl)C=O','C1=CC(=NC(=C1)Cl)C(=O)C=O','C1=C2C(=CC(=C1Cl)O)OC=N2'
        ]
      },
	'2025-08-17': {
	num: '3', formula: 'C<sub>10</sub>H<sub>10</sub>SO',
        ir: ['3006', '2915', '1680', '1597'], uv: ['275 nm'],
	hnmrFreq: "80 MHz", hnmrImage: '2025/08/17/HNMR.png', cnmrImage: '2025/08/17/CNMR.png',
        answer: 0, smiles: [
          'CC1=CC2=C(C=C1)SCCC2=O','C1CC(=O)C2=CC=CC=C2SC1','C1CC(=CC(=O)C1)C2=CSC=C2','CC1CSC2=CC=CC=C2C1=O','CC(=O)/C=C/SC1=CC=CC=C1','CSC1=CC2=C(CCC2=O)C=C1','C[C](C1=CSC2=CC=CC=C21)O','C1CC2=C(C=CC(=C2)C=O)SC1','CC1=CC2=C(C(=C1)OC)SC=C2','CC1=CC2=C(C=C1)SC(=C2)CO','CCC1C2=CC=CC=C2C(=O)S1','CC1=C(SC2=C1C=CC(=C2)O)C'
        ]
      },
	'2025-08-18': {
	num: '4', formula: 'C<sub>8</sub>H<sub>8</sub>O<sub>3</sub>',
        ir: ['3339', '2911', '2839', '1679', '1589'], uv: ['348 nm'],
	hnmrFreq: "80 MHz", hnmrImage: '2025/08/18/HNMR.png', cnmrImage: '2025/08/18/CNMR.png',
        answer: 0, smiles: [
          'COC1=C(C=CC(=C1)C=O)O','COC(=O)C1=CC=C(C=C1)O','COC(=O)C1=CC=CC=C1O','C1=CC=C(C(=C1)CC(=O)O)O','C1=CC=C(C=C1)C(C(=O)O)O','CC1=C(C(=CC=C1)C(=O)O)O','CC(=O)C1=C(C=C(C=C1)O)O','COC1=CC=C(C=C1)C(=O)O','C1OC2=C(O1)C=C(C=C2)CO','COC1=CC=CC(=C1O)C=O','C1=CC(=C(C=C1CC=O)O)O','C1CCC2=C(C1)C(=O)OC2=O'
        ]
      },
	'2025-08-19': {
	num: '5', formula: 'C<sub>5</sub>H<sub>8</sub>O',
        ir: ['2941', '1830', '1670'], uv: ['None'],
	hnmrFreq: "80 MHz", hnmrImage: '2025/08/19/HNMR.png', cnmrImage: '2025/08/19/CNMR.png',
        answer: 0, smiles: [
          'CC1OCC=C1','C1CCC(=O)C1','CC(=CC=O)C','CCC(=O)C=C','CC/C=C/C=O','C/C=C/C(=O)C','CC(=C)C(=O)C','C=CC(C=C)O','C1CC=COC1','CC(=O)C1CC1','CC1=COCC1','C1CC(C=C1)O']
      },
	'2025-08-20': {
	num: '6', formula: 'C<sub>7</sub>H<sub>7</sub>ClO',
        ir: ['3653', '3573', '3042', '2938', '1603', '1471'], uv: ['280 nm'],
	hnmrFreq: "80 MHz", hnmrImage: '2025/08/20/HNMR.png', cnmrImage: '2025/08/20/CNMR.png',
        answer: 0, smiles: [
          'CC1=C(C(=CC=C1)Cl)O','CC1=C(C=C(C=C1)Cl)O','COC1=CC=C(C=C1)Cl','C1=CC(=CC=C1CO)Cl','C1=CC(=CC(=C1)Cl)CO','CC1=CC(=CC(=C1)Cl)O','C1C=CC2C1C(=O)C2Cl','CC1(C=CC(=O)C=C1)Cl','CC1=CC(=O)C(=CC1)Cl','ClC(C1C=CCC=C1)=O','ClC(C1=CC=CCC1)=O','ClC(C#CC1CCC1)=O']
      },
	'2025-08-21': {
	num: '7', formula: 'C<sub>6</sub>H<sub>6</sub>S',
        ir: ['3083', '2938', '1746'], uv: ['None'],
	hnmrFreq: "200 MHz", hnmrImage: '2025/08/21/HNMR.png', cnmrImage: '2025/08/21/CNMR.png',
        answer: 0, smiles: [
          'S=C1C2CC=C1C2','C1=CC=C(C=C1)S','C=CC1=CC=CS1','C1=CC=CSC=C1','C1=CC2C(S2)C=C1','C1C=CC=CC1=S','C=C1C=CC=C1S','C12C3C1C4C(C23)S4','CC1=CC(=S)C=C1', 'C=CC(=S)C=C=C','C1=CC2C=CC1S2','CC1=CC2=C(C2)S1']
      },
	'2025-08-22': {
	num: '8', formula: 'C<sub>7</sub>H<sub>9</sub>NO',
        ir: ['3600', '3438', '3049', '2931', '1718', '1593'], uv: ['216 nm', '295 nm'],
	hnmrFreq: "100 MHz", hnmrImage: '2025/08/22/HNMR.png', cnmrImage: '2025/08/22/CNMR.png',
        answer: 0, smiles: [
          'O=C1NC(C)C=CC=C1','COC1=CC=CC=C1N','OC1=C(C)C(N)=CC=C1','C1=CC=C(C(=C1)CO)N','C1C=CCC2C1C(=O)N2','C1C[C]2C=CC(=O)N2C1','C1CCC(=O)C(C1)C#N','CC1=NC=CC(=C1)OC','COC1=NC=CC=CC1', 'C1CC(CC(=O)C1)C#N','C1CC2C=CC1C(=O)N2','CC1(CCC(=O)C1)C#N']
      },
	'2025-08-23': {
	num: '9', formula: 'C<sub>6</sub>H<sub>14</sub>O<sub>2</sub>',
        ir: ['3587', '2980', '2934', '1381'], uv: ['None'],
	hnmrFreq: "100 MHz", hnmrImage: '2025/08/23/HNMR.png', cnmrImage: '2025/08/23/CNMR.png',
        answer: 0, smiles: [
          'OC(C(C)(C)O)CC','CC(O)C(C)(C)OC','CC(CC(C)(C)O)O','CCCCOCCO','CCCOCC(C)O','CC(C)OCC(C)O','CCC(CO)C(C)O','C(C)C(OC)OCC','CC(C)(CCCO)O', 'CC(C)(CO)COC','CC(C)OC(C)(O)C','CC(CC)(C)C(O)O']
      },
	'2025-08-24': {
	num: '10', formula: 'C<sub>5</sub>H<sub>9</sub>NO<sub>2</sub>',
        ir: ['3409', '3058', '2984', '2380', '1625', '1585'], uv: ['None'],
	hnmrFreq: "200 MHz", hnmrImage: '2025/08/24/HNMR.png', cnmrImage: '2025/08/24/CNMR.png',
        answer: 0, smiles: [
          'O=C(O)C1NCCC1','C1COCCN1C=O','C1CC(C1)(C(=O)O)N','CC(=O)NCCC=O','COC1CCC(=O)N1','CC(=O)N(C)C(=O)C','CC1(COC(=O)N1)C','C1CC(=O)N(C1)CO','CC(=O)CC(=O)NC','C1CNCC1C(=O)O','O=C(N)C1OCCC1','CN(C)/C=C/C(O)=O']
      },
	'2025-08-25': {
	num: '11', formula: 'C<sub>7</sub>H<sub>11</sub>BrO',
        ir: ['3043', '2979', '2856', '1997', '1644'], uv: ['None'],
	hnmrFreq: "100 MHz", hnmrImage: '2025/08/25/HNMR.png', cnmrImage: '2025/08/25/CNMR.png',
        answer: 0,
        smiles: [
          'CC1=COCC(C)C1Br','CC1(CCCCC1=O)Br','C1CCC(C(=O)CC1)Br','C1CC(C(=O)C1)CCBr','CC12CC(C1)(CO2)CBr','C1COC12CC(C2)CBr','C1CC2C(CC1O2)CBr','C1CCC(=C(C1)CO)Br','C1CCC(CC1)C(=O)Br','C1CC2CC1C(C2Br)O','COC1CCCC(=C1)Br','CC(=C/C(=C(\C)/O)/Br)C']
      },
	'2025-08-26': {
	num: '12', formula: 'C<sub>10</sub>H<sub>8</sub>O<sub>2</sub>',
        ir: ['3320', '2972', '2865', '1601', '1558'], uv: ['234 nm'],
	hnmrFreq: "100 MHz", hnmrImage: '2025/08/26/HNMR.png', cnmrImage: '2025/08/26/CNMR.png',
        answer: 0, smiles: [
          'OC1=C2C(C(O)=CC=C2)=CC=C1','OC1=CC=C(C=C(O)C=C2)C2=C1','CC1=CC2=C(C=C1)OC(=O)C=C2','C1=CC=C2C(=C1)C(=CC=C2O)O','C1=CC=C2C=C(C(=CC2=C1)O)O','C1=CC=C2C(=C1)C=C(C=C2O)O','C1=CC(=CC2=C1C=CC(=C2)O)O','CC1=CC(=O)OC2=CC=CC=C12','CC1=CC2=CC=CC=C2OC1=O','CC(=O)C1=CC2=CC=CC=C2O1','CC1C(=O)C2=CC=CC=C2C1=O','C1C(=CC(=O)O1)C2=CC=CC=C2']
      },
	'2025-08-27': {
	num: '13',
        formula: 'C<sub>12</sub>H<sub>14</sub>O<sub>3</sub>',
        ir: ['2970', '1781', '1747', '1583'],
        uv: ['228 nm', '273 nm'],
	hnmrFreq: "100 MHz",
        hnmrImage: '2025-08-27/HNMR.png',
        cnmrImage: '2025-08-27/CNMR.png',
        answer: 0,
        smiles: [
          'CC(C1C(OCC)=O)(O1)C2=CC=CC=C2','COC1=C(C=C2C(=C1)CCCC2=O)OC','CC(=O)OC1=C(C=C(C=C1)CC=C)OC','CCOC(=O)C(=O)CCC1=CC=CC=C1','CC(=O)C1=CC=C(C=C1)CCOC(=O)C','CC(C)(C1CC2=C(O1)C=CC(=C2)C=O)O','CC1(OC(C(=O)O1)CC2=CC=CC=C2)C','CC(C=O)(C1OCCO1)C2=CC=CC=C2','CC1=C(C(=CC=C1)CC(=O)C)C(=O)OC','C1CCOC(C1)C2=CC=CC(=C2O)C=O','CC1CC2=C(C(=O)C=C(C2=CO1)OC)C','CC(C)C1=CC(=C(C(=O)C=C1)O)C(=O)C']
      },
	'2025-08-28': {
	num: '14',
        formula: 'C<sub>5</sub>H<sub>11</sub>NO',
        ir: ['2965', '2865', '2800', '2691', '1458'],
        uv: ['None'],
	hnmrFreq: "100 MHz",
        hnmrImage: '2025-08-28/HNMR.png',
        cnmrImage: '2025-08-28/CNMR.png',
        answer: 0,
        smiles: [
          'CN1CCOCC1','CC1COCCN1','CC1(COCN1)C','CCN(CC)C=O','CC(C)(C)NC=O','CCCCC(=O)N','CC(C)(C)C(=O)N','CN1CCCOC1','C1CC(OC1)CN','C1CNCCC1O','C1CC(CNC1)O','C1COCCC1N']
      },
	'2025-08-29': {
	num: '15',
        formula: 'C<sub>6</sub>H<sub>6</sub>ClN',
        ir: ['3033', '2942', '2198', '2255'],
        uv: ['None'],
	hnmrFreq: "100 MHz",
        hnmrImage: '2025-08-29/HNMR.png',
        cnmrImage: '2025-08-29/CNMR.png',
        answer: 0,
        smiles: [
          'ClC1C=CC(C#N)C1','C1=CC=C(C(=C1)N)Cl','CC1=CN=C(C=C1)Cl','C1=CC(=CC(=C1)Cl)N','C1=CC(=CN=C1)CCl','C1CC(C(=C1)C#N)Cl','C(CC#CC#N)CCl','C=C1CC(C1)(C#N)Cl ','C1C=CC=C(C1=N)Cl','C(C=CC=CC#N)Cl','C/C(=C(\C=C)/Cl)/C#N','C1=CNC=CC(=C1)Cl']
      },
	'2025-08-30': {
	num: '16',
        formula: 'C<sub>7</sub>H<sub>4</sub>F<sub>4</sub>',
        ir: ['3049', '2911', '1624', '1597', '1500', '1469'],
        uv: ['251 nm'],
	hnmrFreq: "200 MHz",
        hnmrImage: '2025-08-30/HNMR.png',
        cnmrImage: '2025-08-30/CNMR.png',
        answer: 0,
        smiles: [
          'FC1=C(C(F)(F)F)C=CC=C1','FC(F)(F)C1=CC(F)=CC=C1','FC(F)(F)C1=CC=C(F)C=C1','CC1=C(F)C(F)=C(F)C(F)=C1','FC1=C(C)C(F)=C(F)C(F)=C1','FC1=C(F)C(C)=C(F)C(F)=C1','FC1=C(F)C(CF)=CC(F)=C1','FC1=C(F)C(C(F)F)=CC=C1','FC1=C(F)C(CF)=CC=C1F','FC1=C(F)C(CF)=C(F)C=C1','C=CC#C/C(F)=C/C(F)(F)F','F/C=C/C#C/C=C/C(F)(F)F']
      },
	'2025-08-31': {
	num: '17',
        formula: 'C<sub>7</sub>H<sub>8</sub>O',
        ir: ['3049', '2945', '2890', '1711'],
        uv: ['None'],
	hnmrFreq: "80 MHz",
        hnmrImage: '2025-08-31/HNMR.png',
        cnmrImage: '2025-08-31/CNMR.png',
        answer: 0,
        smiles: [
          'O=C1C=CCC/C1=C','OC1=C(C)C=CC=C1','OC1=CC(C)=CC=C1','CC1=CCC=CC1=O','O=C1C(C)=CC(C)=C1', 'O=C1CC2CC=C1C2', 'O=C1C=CCC(C)=C1','O=C1C=CCC(C1)=C','O=C(CC1)C=CC1=C','COC1=CC=CC=C1','O=C1C=C(C)C(C1)=C','O=C1C=CC(C)C1=C']
      },
	'2025-09-01': {
	num: '1',
        formula: 'C<sub>6/sub>H<sub>14</sub>N<sub>2</sub>',
        ir: ['3052', '2979', '2941', '2809', '1653', '1207'],
        uv: ['None'],
	hnmrFreq: "80 MHz",
        hnmrImage: '2025-09-01/HNMR.png',
        cnmrImage: '2025-09-1/CNMR.png',
        answer: 0,
        smiles: [
          'CN(/C=C(C)/CN)C','CN1CCCNCC1','C1CCC(C1)(CN)N','C1CCN(C1)CCN','CN(C)/C=C(C)/NC', 'C1CC(C(C1)N)CN', 'CNCN/C=C(C)/C','N=C(C(C)(C)C)NC','CN1CC(C1)CCN','CC(=C)CNCCN','CN(/C(N)=C(C)/C)C','CN/C=C(CC)/CN']
      },

    };

const today = new Date();
const dateStr = today.toISOString().split('T')[0]; // YYYY-MM-DD
	won = false;
	archive = false;
	if (getCookie(dateStr + "-won") === "true") won = true; 
	current = puzzles["default"];
	if (dateStr in puzzles) current = puzzles[dateStr]; // first puzzle in file
	else current = puzzles["default"];
	
	const yesterday = new Date(today - 86400000);
	const yesterdayStr = yesterday.toISOString().split('T')[0]; // YYYY-MM-DD
	streak = 0;
	if ((getCookie("lastPlayed") === yesterdayStr || getCookie("lastPlayed") === dateStr) && getCookie("streak") !== "") {
		streak = Number(getCookie("streak"));
	}
	longestStreak = 0;
	if (getCookie("longestStreak") !== "") longestStreak = Number(getCookie("longestStreak"));
	gamesPlayed = 0;
	if (getCookie("gamesPlayed") !== "") gamesPlayed = Number(getCookie("gamesPlayed"));

    lives_stored = getCookie(dateStr + "-lives");
    if (lives_stored === "") lives_stored = "5";
    let lives = Number(lives_stored);
    const grid = document.getElementById('grid');
    const livesEl = document.getElementById('lives');
    const streakEl = document.getElementById('streak');
    livesEl.textContent = lives;
    streakEl.textContent = streak;

	let correct_smiles = current.smiles[current.answer];
	shuffle(current.smiles);
	current.answer = current.smiles.indexOf(correct_smiles);

    function renderSMILES(){
        let moleculeOptions = {};
        let reactionOptions = {};
      if (document.getElementById("themeToggle").checked) {
		setCookie("theme", "dark", 365);
		document.getElementById("icon").className = "icon-dark";
		document.getElementById("hnmrImage").style.filter = "invert()";
		document.getElementById("cnmrImage").style.filter = "invert()";
	}
      else {
		setCookie("theme", "light", 365);
		document.getElementById("icon").className = "icon";
		document.getElementById("hnmrImage").style.filter = "";
		document.getElementById("cnmrImage").style.filter = "";
	}

      current.smiles.forEach((src,i)=>{

        let sd = new SmiDrawer(moleculeOptions, reactionOptions);
	let ID = "img-" + i.toString()	;
	if ( document.getElementById("themeToggle").checked === false ) {
		sd.draw(src, "#" + ID, "light");	
	} else {
		sd.draw(src, "#" + ID, "dark");
	}
	});

}

    function renderPuzzle(){
      document.getElementById('formula').innerHTML = "<h3>Molecular Formula: " + current.formula + "</h3>";
      document.getElementById('ir').innerHTML = current.ir.map(p=>`${p} cm‚Åª¬π`).join(', ');
      document.getElementById('uv').innerHTML = current.uv.map(p=>`${p}`).join(', ');
      document.getElementById('hnmrImage').src = current.hnmrImage;
      document.getElementById('cnmrImage').src = current.cnmrImage;
      document.getElementById('number').innerHTML = "#" + current.num;
      document.getElementById('hnmrFreq').innerHTML = current.hnmrFreq;

      document.getElementById('hnmrImage').onclick = () => openFullscreen(current.hnmrImage);
      document.getElementById('cnmrImage').onclick = () => openFullscreen(current.cnmrImage);

      grid.innerHTML = '';
      current.smiles.forEach((src,i)=>{
        const tile = document.createElement('div');
        tile.className = 'tile';
	if (i === current.answer) {
		tile.id = "correct_tile";
	}
        const img = document.createElement('img');
	img.id = "img-" + i.toString();

        tile.appendChild(img);
        tile.addEventListener('click', ()=>{
          if(tile.classList.contains('correct') || tile.classList.contains('incorrect') || lives <= 0 || won) return;
          if(i === current.answer){
            tile.classList.add('correct');
	    won = true;
	    if (!archive) {
	    setCookie(dateStr + "-" + src.replace(/=/g, "~"), "correct", 1);
	    setCookie(dateStr + "-won", "true", 1);
	    streak++;
	    longestStreak = Math.max(longestStreak, streak);
	    setCookie("longestStreak", longestStreak, 365);
	    setCookie("streak", streak, 365);
	    setCookie("lastPlayed", dateStr, 365);
		gamesPlayed++;
		setCookie("gamesPlayed", gamesPlayed, 365);
	    streakEl.textContent = streak;
		updateLivesDistribution(lives);
	    showWinModal();
	    }
		else { showArchiveWinModal(); }
          } else {
            tile.classList.add('incorrect');
            lives--;
            livesEl.textContent = lives;
	
	   if (!archive) {
	    setCookie(dateStr + "-lives", lives.toString(), 1);
	    setCookie(dateStr + "-" + src.replace(/=/g, "~"), "incorrect", 1);
		}
            if(lives <= 0){
		if (!archive) {
		document.getElementById("correct_tile").classList.add('correct');
       	        setCookie(dateStr + "-" + correct_smiles.replace(/=/g, "~"), "correct", 1);
		gamesPlayed++;
		setCookie("gamesPlayed", gamesPlayed, 365);
		updateLivesDistribution(0);
		}
		showLoseModal();
            }
          }
        });

	if (getCookie(dateStr + "-" + src.replace(/=/g, "~")) === "incorrect") {
            tile.classList.add('incorrect');
	} else if (getCookie(dateStr + "-" + src.replace(/=/g, "~")) === "correct") {
            tile.classList.add('correct');
	}	

        grid.appendChild(tile);        

      });

	/*
    if (getCookie("theme") === "dark") {
//	document.getElementById("themeToggle").checked = true;
//        document.body.classList.toggle('dark', e.target.checked);
    }
	*/

    }

document.getElementById('closeWin').addEventListener('click', () => {
  document.getElementById('winModal').style.display = 'none';
});

document.getElementById('closeArchiveWin').addEventListener('click', () => {
  document.getElementById('winArchiveModal').style.display = 'none';
});

document.getElementById('closeLose').addEventListener('click', () => {
  document.getElementById('loseModal').style.display = 'none';
});

document.getElementById('statsBtn').addEventListener('click', () => {
  updateStatsModal();
  document.getElementById('statsModal').style.display = 'flex';
});

document.getElementById('closeStats').addEventListener('click', () => {
  document.getElementById('statsModal').style.display = 'none';
});


document.getElementById('shareBtn').addEventListener('click', () => {
  const shareText = `I solved today‚Äôs NMRdle with ${lives} ‚ù§Ô∏è remaining. Try to beat me! https://tmncollins.github.io/Tired-Programmer/qchem/NMRdle`;
  navigator.clipboard.writeText(shareText).then(() => {
    alert('Result copied to clipboard!');
  });
});

function shuffle(array) {
  let currentIndex = array.length;

  // While there remain elements to shuffle...
  while (currentIndex != 0) {

    // Pick a remaining element...
    let randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex--;

    // And swap it with the current element.
    [array[currentIndex], array[randomIndex]] = [
      array[randomIndex], array[currentIndex]];
  }
}

function showWinModal(){
  let NUM = document.getElementById('number').innerHTML;
  document.getElementById('winMessage').textContent = 
    'You solved NMRdle ' + NUM + ` with ${lives} lives remaining!`;
  document.getElementById('winModal').style.display = 'flex';
}

function showArchiveWinModal(){
  let NUM = document.getElementById('number').innerHTML;
  document.getElementById('winArchiveMessage').textContent = 
    'You solved NMRdle ' + NUM + ` with ${lives} lives remaining!`;
  document.getElementById('winArchiveModal').style.display = 'flex';
}

function showLoseModal(){
  document.getElementById('loseModal').style.display = 'flex';
}

function updateStatsModal(){
renderStats();
  document.getElementById('gamesPlayed').textContent = gamesPlayed;
  document.getElementById('currentStreak').textContent = streak;
  document.getElementById('longestStreak').textContent = longestStreak;
}

function setCookie(cname, cvalue, exdays) {
  const d = new Date();
  d.setTime(d.getTime() + (exdays*24*60*60*1000));
  let expires = "expires="+ d.toUTCString();
  document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
}

function getCookie(cname) {
  let name = cname + "=";
  let decodedCookie = decodeURIComponent(document.cookie);
  let ca = decodedCookie.split(';');
  for(let i = 0; i <ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}

function updateLivesDistribution(finalLives) {
  let dist = JSON.parse(getCookie('livesDistribution') || '{}');
  if (!dist[finalLives]) dist[finalLives] = 0;
  dist[finalLives]++;
  setCookie('livesDistribution', JSON.stringify(dist), 365);
}

function renderStats() {
  let dist = JSON.parse(getCookie('livesDistribution') || '{}');
  const bar = document.getElementById('livesBar');
  bar.innerHTML = ''; // clear old segments

  let total = Object.values(dist).reduce((a, b) => a + b, 0);
  if (total === 0) return; // nothing yet

  for (let i = 0; i <= 5; i++) {
    let count = dist[i] || 0;
    if (count > 0) {
      const seg = document.createElement('div');
      seg.className = `bar-segment lives-${i}`;
      seg.style.flex = count; // proportional width
      seg.textContent = i;
      bar.appendChild(seg);
    }
  }
}

    renderPuzzle();

    renderSMILES();

    document.getElementById('themeToggle').addEventListener('change', (e)=>{
      document.body.classList.toggle('dark', e.target.checked);
      renderSMILES();
    });

    function openFullscreen(src){
      const overlay = document.getElementById('fullscreenOverlay');
      const fullImg = document.getElementById('fullscreenImage');
      fullImg.src = src;
      if (document.getElementById("themeToggle").checked) fullImg.style.filter = "invert()";
      else fullImg.style.filter = "";
      overlay.style.display = 'flex';
    }
    document.getElementById('closeFullscreen').onclick = () => {
      document.getElementById('fullscreenOverlay').style.display = 'none';
    }
// About modal logic
const aboutModal = document.getElementById('aboutModal');
const infoBtn = document.getElementById('infoBtn');
const closeAbout = document.getElementById('closeAbout');

infoBtn.onclick = () => { aboutModal.style.display = 'flex'; };
closeAbout.onclick = () => { aboutModal.style.display = 'none'; };
window.onclick = (e) => { if (e.target === aboutModal) aboutModal.style.display = 'none'; };

const donateBtn = document.getElementById('donateBtn');
const donateModal = document.getElementById('donateModal');
const closeDonate = document.getElementById('closeDonate');
const donateAction = document.getElementById('donateAction');

donateBtn.onclick = () => { donateModal.style.display = 'flex'; }
closeDonate.onclick = () => { donateModal.style.display = 'none'; }
donateModal.onclick = (e) => { if(e.target === donateModal) donateModal.style.display = 'none'; }

donateAction.onclick = () => {
//  window.open("https://www.buymeacoffee.com/yourlink", "_blank"); // replace with your link
}


// Calendar modal logic
const calendarModal = document.getElementById("calendarModal");
document.getElementById("closeCalendar").onclick = () => {
  calendarModal.style.display = "none";
};
document.getElementById("loadDateBtn").onclick = () => {
  const dateVal = document.getElementById("puzzleDate").value;
  if(dateVal){
    // Try loading that puzzle from your puzzles object or file
    if (puzzles[dateVal]) {
      current = puzzles[dateVal];
    } else {
      current = puzzles["default"];
      alert("No puzzle found for " + dateVal + ", loading default.");
    }
//    shuffle(current);
    archive = true;
    lives = 5;
    won = false;
    livesEl.textContent = lives;
    renderPuzzle();
    renderSMILES();
    calendarModal.style.display = "none";
  }
};

const puzzleDateInput = document.getElementById("puzzleDate");
const startDate = "2025-08-16"; // üîí earliest available puzzle
// helper to mark today
function updateDateHighlight() {
  const today = new Date().toISOString().split('T')[0];
  if (puzzleDateInput.value === today) {
    puzzleDateInput.classList.add("today-selected");
  } else {
    puzzleDateInput.classList.remove("today-selected");
  }
}

// Open modal: default = today
document.getElementById("calendarBtn").onclick = () => {
  const today = new Date().toISOString().split('T')[0];
  puzzleDateInput.value = today;
  puzzleDateInput.max = today;
  puzzleDateInput.min = startDate;
  updateDateHighlight();
  calendarModal.style.display = "flex";
};

// Change event: update highlight if not today
puzzleDateInput.addEventListener("input", updateDateHighlight);


  </script>
</body>


</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Challenge Quiz</title>
<style>
  body {
    background-color: #121213;
    color: #d7dadc;
    font-family: Arial, sans-serif;
    text-align: center;
    margin: 0;
    padding: 0;
  }
  .quiz-container {
    max-width: 500px;
    margin: auto;
    padding: 20px;
  }
  .primary-btn, .option-btn {
    background-color: #121213;
    color: #d7dadc;
    border: 2px solid #3a3a3c;
    padding: 10px 20px;
    margin: 10px;
    cursor: pointer;
    font-size: 16px;
    text-transform: uppercase;
    transition: transform 0.08s ease, background-color 0.08s ease, border-color 0.08s ease;
  }
  .primary-btn:hover, .option-btn:hover {
    transform: scale(0.96);
    background-color: #d3d3d3;
    border-color: #8b8c8e;
    filter: brightness(0.9);
  }
  .option-btn.correct, .primary-btn.correct {
    background-color: #538d4e !important;
    color: white !important;
  }
  .option-btn.incorrect, .primary-btn.incorrect {
    background-color: #b91d1d !important;
    color: white !important;
  }
  .progress-dots {
    display: flex;
    justify-content: center;
    margin-top: 20px;
    gap: 8px;
  }
  .progress-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background-color: #3a3a3c;
    transition: background-color 0.2s ease;
  }
  .progress-dot.correct { background-color: #538d4e; }
  .progress-dot.incorrect { background-color: #b91d1d; }
  .progress-dot.current { outline: 2px solid white; }
</style>
</head>
<body>
<div class="quiz-container" id="container">
  <h2 id="title">Loading...</h2>
  <div id="content"></div>
  <div id="progress" class="progress-dots"></div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
function getTodayKey(){return new Date().toISOString().split('T')[0];}
function getCookie(name){const value = "; " + document.cookie;const parts = value.split("; " + name + "=");if(parts.length===2) return parts.pop().split(";").shift();}
function setCookie(name,value,days){let expires="";if(days){const date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));expires="; expires="+date.toUTCString();}document.cookie=name+"="+(value||"")+expires+"; path=/";}

const questions = [
  { q: "What is the capital of France?", options: ["Berlin","Madrid","Paris","Rome"], answer: 2, hasImages: false },
  { q: "Which planet is known as the Red Planet?", options: ["Earth","Mars","Jupiter","Venus"], answer: 1, hasImages: false },
  { q: "What is 5 + 7?", options: ["10","11","12","13"], answer: 2, hasImages: false },
  { q: "Which gas do plants primarily absorb for photosynthesis?", options: ["Oxygen","Carbon Dioxide","Nitrogen","Helium"], answer: 1, hasImages: false }
];

let currentQuestion = 0, score = 0, answersStatus = [];

(function init() {
  const todayKey = getTodayKey();
  let streak=parseInt(getCookie("quizStreak"))||0;
  let lastPlayed=getCookie("quizLastPlayed");
  if(lastPlayed){
    const y=new Date();
    y.setDate(y.getDate()-1);
    const yKey=y.toISOString().split('T')[0];
    if(lastPlayed===yKey){streak++;}
    else if(lastPlayed!==todayKey){streak=0;}
  }
  const savedScore=getCookie("quizScore-"+todayKey);
  if(savedScore!==undefined){
    document.getElementById("title").innerText="Daily Quiz";
    document.getElementById("content").innerHTML=`<p>You've already played today!</p><p>Your score today: <strong>${savedScore} / ${questions.length}</strong></p><p>Your streak: <strong>${streak} days</strong></p>`;
    return;
  }
  document.getElementById("title").innerText="Daily Quiz";
  document.getElementById("content").innerHTML=`<p>Your streak: <strong>${streak} days</strong></p><button class="primary-btn" id="startBtn">Start Quiz</button>`;
  document.getElementById("startBtn").onclick=startQuiz;
})();

function renderProgressDots() {
  const progressContainer = document.getElementById("progress");
  progressContainer.innerHTML = "";
  for (let i = 0; i < questions.length; i++) {
    const dot = document.createElement("div");
    dot.className = "progress-dot";
    if (answersStatus[i] === "correct") dot.classList.add("correct");
    if (answersStatus[i] === "incorrect") dot.classList.add("incorrect");
    if (i === currentQuestion) dot.classList.add("current");
    progressContainer.appendChild(dot);
  }
}

function startQuiz() {
  currentQuestion = 0;
  score = 0;
  answersStatus = Array(questions.length).fill(null);
  renderProgressDots();
  loadQuestion();
}

function loadQuestion() {
  if (currentQuestion >= questions.length) {
    endQuiz();
    return;
  }
  renderProgressDots();
  const qData = questions[currentQuestion];
  document.getElementById("title").innerHTML = qData.q;
  const contentDiv = document.getElementById("content");
  contentDiv.innerHTML = "";
  if (qData.hasImages) {
    const grid = document.createElement("div");
    grid.className = "option-grid";
    qData.options.forEach((opt, idx) => {
      const btn = document.createElement("button");
      btn.className = "option-btn";
      btn.innerHTML = `<img src="${opt}" alt="Option ${idx+1}">`;
      btn.onclick = () => selectAnswer(idx);
      grid.appendChild(btn);
    });
    contentDiv.appendChild(grid);
  } else {
    qData.options.forEach((opt, idx) => {
      const btn = document.createElement("button");
      btn.className = "primary-btn";
      btn.innerText = opt;
      btn.onclick = () => selectAnswer(idx);
      contentDiv.appendChild(btn);
    });
  }
}

function selectAnswer(idx) {
  const qData = questions[currentQuestion];
  const buttons = document.querySelectorAll(".option-btn, .primary-btn");
  
  if (idx === qData.answer) {
    score++;
    answersStatus[currentQuestion] = "correct";
    buttons[idx].classList.add("correct");
  } else {
    answersStatus[currentQuestion] = "incorrect";
    buttons[idx].classList.add("incorrect");
    buttons[qData.answer].classList.add("correct");
  }

  renderProgressDots();
  buttons.forEach(btn => btn.disabled = true);

  setTimeout(() => {
    currentQuestion++;
    loadQuestion();
  }, 800);
}

function endQuiz() {
  const todayKey = getTodayKey();
  document.getElementById("title").innerText = "Quiz complete!";
  document.getElementById("content").innerHTML = `<div class="result-box">Your score today: <strong>${score} / ${questions.length}</strong></div><button class="primary-btn" onclick="shareScore()">Share Your Score</button><button class="primary-btn" onclick="showStats()">Show Stats</button>`;
  setCookie("quizScore-"+todayKey, score, 1);
  setCookie("quizLastPlayed", todayKey, 365);
  let streak=parseInt(getCookie("quizStreak"))||0;
  setCookie("quizStreak", streak, 365);
  let scoreStats = {};
  try {scoreStats = JSON.parse(getCookie("quizScoreStats") || "{}");} catch(e) {scoreStats = {};} 
  scoreStats[score] = (scoreStats[score] || 0) + 1;
  setCookie("quizScoreStats", JSON.stringify(scoreStats), 365);
}

function shareScore() {
  const shareText = `I scored ${score} / ${questions.length} on today's quiz! 🏆`;
  if (navigator.share) {
    navigator.share({title:"Daily Quiz Score", text:shareText, url:window.location.href}).catch(console.error);
  } else {
    navigator.clipboard.writeText(shareText).then(() => {alert("Score copied to clipboard! Share it anywhere.");});
  }
}

function showStats() {
  let stats = {};
  try {stats = JSON.parse(getCookie("quizScoreStats") || "{}");} catch(e) {stats = {};}
  const labels = Object.keys(stats);
  const data = Object.values(stats);
  if (!labels.length) {alert("No stats available yet.");return;}
  const chartContainer = document.createElement('div');
  chartContainer.innerHTML = '<canvas id="statsChart" width="300" height="300"></canvas>';
  document.getElementById("content").appendChild(chartContainer);
  new Chart(document.getElementById('statsChart'), {
    type: 'pie',
    data: { labels: labels, datasets: [{ data: data, backgroundColor: ['#6aaa64','#c9b458','#787c7e','#a3a6aa'] }] },
    options: { responsive: false }
  });
}
</script>
</body>
</html>
